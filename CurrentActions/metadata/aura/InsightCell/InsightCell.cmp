<aura:component controller="InsightsController">

<ltng:require styles="/resource/SLDS0122/assets/styles/salesforce-lightning-design-system-ltng.css" scripts="/resource/DataTables/datatables.js,/resource/Chartjs,/resource/moment,/resource/underscore" afterScriptsLoaded="{!c.postScript}"/>

<aura:handler name="init" value="{!this}" action="{!c.doInit}" />

<aura:attribute name="insight" type="Insight__c" />
<aura:registerEvent name="selected_insight" type="c:selectInsight"/>

<aura:attribute name="icon" type="String" />
<aura:attribute name="icon_class" type="String" />

<aura:attribute name="index" type="String" />
<aura:attribute name="unread" type="Boolean" />

<aura:attribute name="fullinit" type="Boolean" default='false'/>


<div class="slds">
  <div class="center slds-p-top--xx-large slds-p-bottom--xx-large" style="width:75%">


    <div class="dropdown-float ">
      <div class="slds-dropdown-trigger">
        <button class="slds-button slds-button--icon-border-filled" aria-haspopup="true">
          <c:svg class="slds-button__icon slds-button__icon--hint" xlinkHref="/resource/SLDS0122/assets/icons/utility-sprite/svg/symbols.svg#down" />
          <span class="slds-assistive-text">Show More</span>
        </button>
        <div class="slds-dropdown slds-dropdown--right slds-dropdown--menu">
          <ul class="slds-dropdown__list" role="menu">
            <li id="menu-0-0" class="slds-dropdown__item">
              <a href="javascript:void(0)" role="menuitem" onclick="{!c.openObject}">Go To</a>
            </li>
            <li id="menu-1-1" class="slds-dropdown__item">
              <a href="javascript:void(0)" role="menuitem" onclick="{!c.sendSelectedInsight}">Detail</a>
            </li>
            <li id="menu-2-2" class="slds-dropdown__item">
              <a href="{!'omnifocus:///add?name=' + v.insight.Long_Name__c}" role="menuitem">Add to OmniFocus</a>
            </li>
          </ul>

        </div>
      </div>
    </div>

    <div class="slds-media slds-comment slds-hint-parent slds-p-bottom--large">
      <div class="slds-media__figure">

        <span class="{!'slds-icon__container '+ v.icon_class}">
          <c:svg class="slds-icon" xlinkHref="{!'/resource/SLDS0122/assets/icons/'+ v.icon}" />
          <span class="slds-assistive-text">Icon</span>
        </span>

      </div>
      <div class="slds-media__body">
        <div class="slds-grid slds-grid--align-spread">
          <div class="slds-text-longform slds-text-heading--medium"><aura:unescapedHtml value="{!v.insight.Long_Name__c}"/></div>
        </div>


        <div class="slds-text-body--small" style="color:#8E99A6" >
          <ul class="slds-list--horizontal slds-has-dividers--right slds-has-inline-block-links">
           <li class="slds-list__item" >
             <a target="_blank" href="{!'https://rowan-dev-ed.my.salesforce.com/'+v.insight.Id}"><ui:outputDateTime value="{!v.insight.LastModifiedDate}" format="EEE, h:mm a"/></a>
           </li>
           <li class="slds-list__item" >
            <a target="_blank" href="{!'https://rowan-dev-ed.my.salesforce.com/'+v.insight.ReportID__c}">{!v.insight.Data_Source__c}</a>
          </li>
        </ul>

        <!-- <ul class="slds-list- -horizontal slds-has-dividers- -right slds-has-inline-block-links"> -->
        <aura:unescapedHtml value="{!v.insight.Parents__c}"/>
        <!-- </ul> -->

      </div>

    </div>
  </div>

<div class="slds-p-bottom--xx-large">
  <canvas id="{!'chart-'+v.index}" width="500" height="150"></canvas>
</div>
  <aura:unescapedHtml value="{!v.insight.Details__c}"/>


  <div class="slds-comment__content slds-text-longform slds-text-body--regular slds-p-top--medium slds-p-bottom--xx-large">
  </div>

  <button class="slds-button slds-button--neutral slds-button--brand" onclick="{!c.showModal}">{!'See all '+v.insight.SObject_Count__c}</button>
  <button class="dropdown-float slds-button slds-button--neutral slds-button--brand " onclick="{!c.markUnread}">Mark Unread</button>

</div>


</div>
</aura:component>